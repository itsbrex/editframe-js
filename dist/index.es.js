import t from"audio-extensions";import"image-extensions";import e from"video-extensions";import n from"camelcase-keys";import r,{fetch as i}from"cross-fetch";import o from"util";import a from"os";import u from"form-data";import s,{existsSync as c,createWriteStream as d,writeFileSync as l,mkdirSync as f,rmdirSync as p}from"fs";import h,{resolve as m,parse as v}from"path";import{v4 as g}from"uuid";import{compile as b}from"path-to-regexp";import y from"query-string";import w from"he";import _ from"image-to-base64";import{JSDOM as x}from"jsdom";import{Readable as A}from"stream";import{execSync as k}from"child_process";import R from"find-process";import{Mixin as E}from"ts-mixer";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var T=function(t,e){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},T(t,e)};function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var F,S,C,j,M,L,q,z,P=function(){return P=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},P.apply(this,arguments)};function D(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))}function I(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}!function(t){t.accept="Accept",t.authorization="Authorization",t.contentType="Content-Type",t.editframeClientId="Editframe-Client-Id",t.userAgent="User-Agent",t.xRequestedWith="X-Requested-With"}(F||(F={})),function(t){t.bearer="Bearer ",t.editframeJs="editframe.js/",t.xRequestedWithXML="XMLHttpRequest"}(S||(S={})),function(t){t.delete="delete",t.get="get",t.post="post",t.put="put"}(C||(C={})),function(t){t.description="description",t.id="id",t.name="name",t.webhook="webhook"}(j||(j={})),function(t){t.black="#000000",t.transparent="transparent",t.white="#ffffff"}(M||(M={})),function(t){t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.files="files",t.layers="layers",t.metadata="metadata"}(L||(L={})),function(t){t.backgroundColor="backgroundColor",t.color="color",t.data="data",t.end="end",t.filter="filter",t.fontFamily="fontFamily",t.fontSize="fontSize",t.fontWeight="fontWeight",t.format="format",t.height="height",t.horizontalAlignment="horizontalAlignment",t.html="html",t.id="id",t.isRelative="isRelative",t.lineHeight="lineHeight",t.maxFontSize="maxFontSize",t.maxHeight="maxHeight",t.maxWidth="maxWidth",t.sequence="sequence",t.start="start",t.subtitles="subtitles",t.text="text",t.textAlign="textAlign",t.trim="trim",t.type="type",t.verticalAlignment="verticalAlignment",t.volume="volume",t.waveform="waveform",t.width="width",t.x="x",t.y="y"}(q||(q={})),function(t){t.audio="audio",t.filter="filter",t.html="html",t.image="image",t.lottie="lottie",t.sequence="sequence",t.subtitles="subtitles",t.text="text",t.video="video",t.waveform="waveform"}(z||(z={}));var W,B,H={center:"center",left:"left",right:"right"},N={bottom:"bottom",center:"center",top:"top"},G={brightness:"brightness",contrast:"contrast",fadeIn:"fadein",fadeOut:"fadeout",grayscale:"grayscale",lighten:"lighten",negative:"negative",saturation:"saturation",sobel:"sobel",vintage:"vintage"};!function(t){t.brightness="brightness",t.color="color",t.contrast="contrast",t.duration="duration",t.saturation="saturation",t.startTime="startTime"}(W||(W={})),function(t){t.filterName="filterName",t.options="options"}(B||(B={}));var V,Y,U={fill:"fill",fit:"fit",stretch:"stretch"};!function(t){t.duration="duration",t.framesPerSecond="framesPerSecond",t.page="page",t.url="url",t.withTransparentBackground="withTransparentBackground"}(V||(V={})),function(t){t.backgroundColor="backgroundColor",t.color="color",t.fontSize="fontSize"}(Y||(Y={}));var X,J,$,K={center:"center",justify:"justify",left:"left",right:"right"},Q={bars:"bars",bricks:"bricks",curve:"curve",equalizer:"equalizer",line:"line",pixel:"pixel",roundBars:"roundBars",wave:"wave"};!function(t){t.backgroundColor="backgroundColor",t.color="color",t.style="style"}(X||(X={})),function(t){t.boolean="boolean",t.null="object",t.number="number",t.object="object",t.string="string",t[void 0]="undefined"}(J||(J={})),function(t){t.json="application/json"}($||($={}));var Z,tt,et,nt,rt;!function(t){t.data="data",t.links="links",t.meta="meta"}(Z||(Z={})),function(t){t.first="first",t.last="last",t.next="next",t.prev="prev"}(tt||(tt={})),function(t){t.active="active",t.label="label",t.url="url"}(et||(et={})),function(t){t.currentPage="currentPage",t.from="from",t.lastPage="lastPage",t.links="links",t.path="path",t.perPage="perPage",t.to="to",t.total="total"}(nt||(nt={})),function(t){t.page="page",t.perPage="per_page"}(rt||(rt={}));var it,ot,at,ut,st,ct,dt,lt,ft,pt={all:"/applications",get:"/applications/:id"},ht="/metadata",mt={all:"/videos",create:"/videos",get:"/videos/:id"};!function(t){t.setMuted="setMuted",t.setVolume="setVolume"}(it||(it={})),function(t){t.addAudio="addAudio",t.addFilter="addFilter",t.addHTML="addHTML",t.addImage="addImage",t.addLottie="addLottie",t.addSequence="addSequence",t.addSubtitles="addSubtitles",t.addText="addText",t.addVideo="addVideo",t.addWaveform="addWaveform",t.aspectRatio="_aspectRatio",t.backgroundColor="backgroundColor",t.dimensions="dimensions",t.duration="duration",t.encode="encode",t.getLayerAttribute="getLayerAttribute",t.getMetadata="_getMetadata",t.layer="layer",t.layers="layers",t.metadata="metadata",t.preview="preview",t.setLayer="setLayer",t.updateFile="updateFile",t.updateLayerAttribute="updateLayerAttribute"}(ot||(ot={})),function(t){t.id="id",t.status="status",t.timestamp="timestamp"}(at||(at={}));var vt,gt,bt,yt,wt,_t,xt,At,kt,Rt=((ut={})[G.brightness]=((st={})[W.brightness]=J.number,st),ut[G.contrast]=((ct={})[W.contrast]=J.number,ct),ut[G.fadeIn]=((dt={})[W.color]=J.string,dt[W.duration]=J.number,dt[W.startTime]=J.number,dt),ut[G.fadeOut]=((lt={})[W.color]=J.string,lt[W.duration]=J.number,lt[W.startTime]=J.number,lt),ut[G.saturation]=((ft={})[W.saturation]=J.number,ft),ut);!function(t){t.setFilter="setFilter"}(vt||(vt={})),function(t){t.setHTMLOptions="setHTMLOptions"}(gt||(gt={})),function(t){t.setStart="setStart"}(bt||(bt={})),function(t){t.setAnimationData="setAnimationData"}(yt||(yt={})),function(t){t.setTrim="setTrim"}(wt||(wt={})),function(t){t.bitrate="bitrate",t.codec="codec",t.duration="duration",t.fps="fps",t.height="height",t.samplerate="samplerate",t.size="size",t.width="width"}(_t||(_t={})),function(t){t.type="type"}(xt||(xt={})),function(t){t.audio="audio",t.image="image",t.video="video"}(At||(At={})),function(t){t.setIsRelative="setIsRelative",t.setX="setX",t.setY="setY"}(kt||(kt={}));var Et,Tt,Ot,Ft,St,Ct,jt,Mt,Lt="".concat("./.preview","/config.json");!function(t){t.setDimensions="setDimensions",t.setFormat="setFormat",t.setHeight="setHeight",t.setWidth="setWidth"}(Et||(Et={})),function(t){t.setStart="setStart"}(Tt||(Tt={})),function(t){t.setSubtitlesOptions="setSubtitlesOptions"}(Ot||(Ot={})),function(t){t.setColor="setColor",t.setFontFamily="setFontFamily",t.setFontSize="setFontSize",t.setFontWeight="setFontWeight",t.setLineHeight="setLineHeight",t.setMaxFontSize="setMaxFontSize",t.setMaxHeight="setMaxHeight",t.setMaxWidth="setMaxWidth",t.setText="setText",t.setTextAlignment="setTextAlignment"}(Ft||(Ft={})),function(t){t.setDimensions="setDimensions",t.setFilter="setFilter"}(St||(St={})),function(t){t.setBackgroundColor="setBackgroundColor",t.setColor="setColor",t.setDimensions="setDimensions",t.setFilter="setFilter",t.setFormat="setFormat",t.setHeight="setHeight",t.setWidth="setWidth",t.setX="setX",t.setY="setY"}(Ct||(Ct={})),function(t){t.downloadUrl="downloadUrl",t.duration="duration",t.id="id",t.isFailed="isFailed",t.isReady="isReady",t.metadata="metadata",t.streamUrl="streamUrl",t.thumbnailUrl="thumbnailUrl",t.timestamp="timestamp"}(jt||(jt={})),function(t){t.all="all",t.get="get",t.getMetadata="_getMetadata",t.new="new"}(Mt||(Mt={}));var qt=function(t,e){return"".concat(t," - ").concat(e)},zt=function(t){return"Error getting applications: ".concat(t)},Pt="malformed `applications` response";function Dt(t,e){return t(e={exports:{}},e.exports),e.exports}var It=Dt((function(t){var e={};t.exports=e;var n={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(n).forEach((function(t){var r=n[t],i=e[t]=[];i.open="["+r[0]+"m",i.close="["+r[1]+"m"}))})),Wt=function(t,e){var n=(e=e||process.argv).indexOf("--"),r=/^-{1,2}/.test(t)?"":"--",i=e.indexOf(r+t);return-1!==i&&(-1===n||i<n)},Bt=process.env,Ht=void 0;function Nt(t){var e=function(t){if(!1===Ht)return 0;if(Wt("color=16m")||Wt("color=full")||Wt("color=truecolor"))return 3;if(Wt("color=256"))return 2;if(t&&!t.isTTY&&!0!==Ht)return 0;var e=Ht?1:0;if("win32"===process.platform){var n=a.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in Bt)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some((function(t){return t in Bt}))||"codeship"===Bt.CI_NAME?1:e;if("TEAMCITY_VERSION"in Bt)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Bt.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in Bt){var r=parseInt((Bt.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Bt.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Bt.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(Bt.TERM)||"COLORTERM"in Bt?1:(Bt.TERM,e)}(t);return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(e)}Wt("no-color")||Wt("no-colors")||Wt("color=false")?Ht=!1:(Wt("color")||Wt("colors")||Wt("color=true")||Wt("color=always"))&&(Ht=!0),"FORCE_COLOR"in Bt&&(Ht=0===Bt.FORCE_COLOR.length||0!==parseInt(Bt.FORCE_COLOR,10));var Gt,Vt,Yt=Nt,Ut=(Nt(process.stdout),Nt(process.stderr),Dt((function(t){t.exports=function(t,e){var n="";t=(t=t||"Run the trap, drop the bass").split("");var r={a:["@","ƒÑ","»∫","…Ö","Œî","Œõ","–î"],b:["√ü","∆Å","…É","…Æ","Œ≤","‡∏ø"],c:["¬©","»ª","œæ"],d:["√ê","∆ä","‘Ä","‘Å","‘Ç","‘É"],e:["√ã","ƒï","∆é","…ò","Œ£","Œæ","“º","‡©¨"],f:["”∫"],g:["…¢"],h:["ƒ¶","∆ï","“¢","“∫","”á","‘ä"],i:["‡ºè"],j:["ƒ¥"],k:["ƒ∏","“†","”É","‘û"],l:["ƒπ"],m:[" ç","”ç","”é","‘†","‘°","‡µ©"],n:["√ë","≈ã","∆ù","Õ∂","Œ†","“ä"],o:["√ò","√µ","√∏","«æ"," ò","—∫","◊ù","€ù","‡πè"],p:["«∑","“é"],q:["‡ßç"],r:["¬Æ","∆¶","»ê","…å"," Ä","–Ø"],s:["¬ß","œû","œü","œ®"],t:["≈Å","≈¶","Õ≥"],u:["∆±","’ç"],v:["◊ò"],w:["–®","—†","—º","‡µ∞"],x:["“≤","”æ","”º","”Ω"],y:["¬•","“∞","”ã"],z:["∆µ","…Ä"]};return t.forEach((function(t){t=t.toLowerCase();var e=r[t]||[" "],i=Math.floor(Math.random()*e.length);n+=void 0!==r[t]?r[t][i]:t})),n}}))),Xt=Dt((function(t){t.exports=function(t,e){t=t||"   he is here   ";var n={up:["Ãç","Ãé","ÃÑ","ÃÖ","Ãø","Ãë","ÃÜ","Ãê","Õí","Õó","Õë","Ãá","Ãà","Ãä","ÕÇ","Ãì","Ãà","Õä","Õã","Õå","ÃÉ","ÃÇ","Ãå","Õê","ÃÄ","ÃÅ","Ãã","Ãè","Ãí","Ãì","Ãî","ÃΩ","Ãâ","Õ£","Õ§","Õ•","Õ¶","Õß","Õ®","Õ©","Õ™","Õ´","Õ¨","Õ≠","ÕÆ","ÕØ","Ãæ","Õõ","ÕÜ","Ãö"],down:["Ãñ","Ãó","Ãò","Ãô","Ãú","Ãù","Ãû","Ãü","Ã†","Ã§","Ã•","Ã¶","Ã©","Ã™","Ã´","Ã¨","Ã≠","ÃÆ","ÃØ","Ã∞","Ã±","Ã≤","Ã≥","Ãπ","Ã∫","Ãª","Ãº","ÕÖ","Õá","Õà","Õâ","Õç","Õé","Õì","Õî","Õï","Õñ","Õô","Õö","Ã£"],mid:["Ãï","Ãõ","ÃÄ","ÃÅ","Õò","Ã°","Ã¢","Ãß","Ã®","Ã¥","Ãµ","Ã∂","Õú","Õù","Õû","Õü","Õ†","Õ¢","Ã∏","Ã∑","Õ°"," “â"]},r=[].concat(n.up,n.down,n.mid);function i(t){return Math.floor(Math.random()*t)}function o(t){var e=!1;return r.filter((function(n){e=n===t})),e}return function(t,e){var r,a,u="";for(a in(e=e||{}).up=void 0===e.up||e.up,e.mid=void 0===e.mid||e.mid,e.down=void 0===e.down||e.down,e.size=void 0!==e.size?e.size:"maxi",t=t.split(""))if(!o(a)){switch(u+=t[a],r={up:0,down:0,mid:0},e.size){case"mini":r.up=i(8),r.mid=i(2),r.down=i(8);break;case"maxi":r.up=i(16)+3,r.mid=i(4)+1,r.down=i(64)+3;break;default:r.up=i(8)+1,r.mid=i(6)/2,r.down=i(8)+1}var s=["up","mid","down"];for(var c in s)for(var d=s[c],l=0;l<=r[d];l++)e[d]&&(u+=n[d][i(n[d].length)])}return u}(t,e)}})),Jt=Dt((function(t){t.exports=function(t){return function(e,n,r){if(" "===e)return e;switch(n%3){case 0:return t.red(e);case 1:return t.white(e);case 2:return t.blue(e)}}}})),$t=Dt((function(t){t.exports=function(t){return function(e,n,r){return n%2==0?e:t.inverse(e)}}})),Kt=Dt((function(t){t.exports=function(t){var e=["red","yellow","green","blue","magenta"];return function(n,r,i){return" "===n?n:t[e[r++%e.length]](n)}}})),Qt=Dt((function(t){t.exports=function(t){var e=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(n,r,i){return" "===n?n:t[e[Math.round(Math.random()*(e.length-2))]](n)}}})),Zt=Dt((function(t){var e={};t.exports=e,e.themes={};var n=e.styles=It,r=Object.defineProperties,i=new RegExp(/[\r\n]+/g);e.supportsColor=Yt,void 0===e.enabled&&(e.enabled=!1!==e.supportsColor()),e.enable=function(){e.enabled=!0},e.disable=function(){e.enabled=!1},e.stripColors=e.strip=function(t){return(""+t).replace(/\x1B\[\d+m/g,"")},e.stylize=function(t,r){if(!e.enabled)return t+"";var i=n[r];return!i&&r in e?e[r](t):i.open+t+i.close};var a=/[|\\{}()[\]^$+*?.]/g;function u(t){var e=function t(){return l.apply(t,arguments)};return e._styles=t,e.__proto__=d,e}var s,c=(s={},n.grey=n.gray,Object.keys(n).forEach((function(t){n[t].closeRe=new RegExp(function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(a,"\\$&")}(n[t].close),"g"),s[t]={get:function(){return u(this._styles.concat(t))}}})),s),d=r((function(){}),c);function l(){var t=Array.prototype.slice.call(arguments),r=t.map((function(t){return null!=t&&t.constructor===String?t:o.inspect(t)})).join(" ");if(!e.enabled||!r)return r;for(var a=-1!=r.indexOf("\n"),u=this._styles,s=u.length;s--;){var c=n[u[s]];r=c.open+r.replace(c.closeRe,c.open)+c.close,a&&(r=r.replace(i,(function(t){return c.close+t+c.open})))}return r}e.setTheme=function(t){if("string"!=typeof t)for(var n in t)!function(n){e[n]=function(r){if("object"==typeof t[n]){var i=r;for(var o in t[n])i=e[t[n][o]](i);return i}return e[t[n]](r)}}(n);else console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));")};var f=function(t,e){var n=e.split("");return(n=n.map(t)).join("")};for(var p in e.trap=Ut,e.zalgo=Xt,e.maps={},e.maps.america=Jt(e),e.maps.zebra=$t(e),e.maps.rainbow=Kt(e),e.maps.random=Qt(e),e.maps)!function(t){e[t]=function(n){return f(e.maps[t],n)}}(p);r(e,function(){var t={};return Object.keys(c).forEach((function(e){t[e]={get:function(){return u([e])}}})),t}())})),te=Dt((function(t){t.exports=Zt})),ee={clientIdAndTokenRequired:"\\".concat(te.white("clientId"),"\\ and \\").concat(te.white("token"),"\\ must be provided to constructor")},ne=function(t){return"\\".concat(te.white(t),"\\ is not a valid path")},re=function(t){return"\\".concat(te.white(t),"\\ is not valid url")},ie=function(t,e,n,r){return"\n  \\".concat(te.white(e),"\\ attribute in \\").concat(te.white(t),"\\ must be of type \\").concat(te.white(r),"\\. Got: \\").concat(te.white(JSON.stringify(n)),"\\")},oe=function(t){return t.join(" | ")},ae=function(t){return"\\".concat(te.white(t),"\\ field is required")},ue=function(t,e){return"".concat(t,": { ").concat(e," }")},se={dataRequired:"\\".concat(te.white("data"),"\\ must be provided"),dimensionsRequired:"\\".concat(te.white("dimensions"),"\\ must be provided unless a \\").concat(te.white("videoFile"),"\\ is provided"),durationRequired:"\\".concat(te.white("duration"),"\\ must be provided unless a \\").concat(te.white("videoFile"),"\\ is provided"),errorEncoding:function(t){return"Error encoding video: ".concat(t)},filterRequired:"\\".concat(te.white("filter"),"\\ must be provided"),htmlPageOrURLRequired:"Either \\".concat(te.white("page"),"\\ or \\").concat(te.white("url"),"\\ must be provided"),malformedEncodingResponse:"malformed ".concat(te.white("encoding"),"\\ response"),optionsRequired:"\\".concat(te.white("options"),"\\ must be provided"),textRequired:"\\".concat(te.white("text"),"\\ field required"),trimEndRequired:function(t){return"layer \\".concat(te.white(t),"\\ must provide \\").concat(te.white(ue(q.trim,q.end)),"\\ attribute in order to calculate position in sequence timeline automatically")},validationOptionsError:function(t){return"Error: ".concat(t)}},ce="Invalid file source provided",de=function(t){return"Invalid layer format: ".concat(t)},le=function(t){return"Error getting videos: ".concat(t)},fe=function(t){return"Error getting video: ".concat(t)},pe="malformed `videos` response",he=function(t){var e=new u;return t.forEach((function(t){e.append(t[0],t[1])})),e},me=function(t){return typeof t===J.string?"url":"file"},ve=function(t){return console.error(te.yellow(t))},ge=function(){"test"!==process.env.NODE_ENV&&process.exit(1)},be=function(t,e){return Array.isArray(e)?e.includes(typeof t):typeof t===e},ye=function(t){try{new URL(t)}catch(e){throw new TypeError(re(t))}},we=function(t,e){if(!t)throw new Error(e)},_e=function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&typeof n!==r){var o=ie(t,e,n,r);if(i)throw new TypeError(o);return o}},xe=function(t,e){try{return t(),e?e():void 0}catch(t){t.name;var n=t.stack;return ve(n),void ge()}},Ae=function(t,e){return D(void 0,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t(),e?[4,e()]:[3,2];case 1:return[2,i.sent()];case 2:return[2,void 0];case 3:return n=i.sent(),r=n.stack,ve(r),ge(),[2,void 0];case 4:return[2]}}))}))},ke=function(t){return et.active in t&&be(t.active,J.boolean)&&et.label in t&&be(t.label,J.string)},Re=function(t,e){return Z.data in t&&Array.isArray(t.data)&&(!(t.data.length>0)||t.data.every(e))&&Z.links in t&&(r=t.links,tt.first in r&&be(r.first,J.string)&&tt.last in r&&be(r.last,J.string))&&Z.meta in t&&(n=t.meta,nt.currentPage in n&&be(n.currentPage,J.number)&&nt.from in n&&be(n.from,[J.number,J.null])&&nt.lastPage in n&&be(n.lastPage,J.number)&&nt.links in n&&n.links.every(ke)&&nt.path in n&&be(n.path,J.string)&&nt.perPage in n&&be(n.perPage,J.string)&&nt.to in n&&be(n.to,[J.number,J.null])&&nt.total in n&&be(n.total,J.number));var n,r},Ee=function(t){return at.id in t&&be(t[at.id],J.string)&&at.status in t&&be(t[at.status],J.string)&&at.timestamp in t&&be(t[at.timestamp],J.number)},Te=function(t){return jt.id in t&&be(t.id,J.string)&&jt.isReady in t&&be(t.isReady,J.boolean)&&jt.isFailed in t&&be(t.isFailed,J.boolean)},Oe=function(t){return Re(t,Te)},Fe=function(t){return _t.bitrate in t&&be(t.bitrate,J.number)&&_t.codec in t&&be(t.codec,J.string)&&_t.duration in t&&be(t.duration,J.number)&&_t.samplerate in t&&be(t.samplerate,J.number)&&_t.size in t&&be(t.size,J.number)},Se=function(t){return _t.codec in t&&be(t.codec,J.string)&&_t.height in t&&be(t.height,J.number)&&_t.size in t&&be(t.size,J.number)&&_t.width in t&&be(t.width,J.number)},Ce=function(t){return _t.bitrate in t&&be(t.bitrate,J.number)&&_t.codec in t&&be(t.codec,J.string)&&_t.duration in t&&be(t.duration,J.number)&&_t.fps in t&&be(t.fps,J.number)&&_t.height in t&&be(t.height,J.number)&&_t.size in t&&be(t.size,J.number)&&_t.width in t&&be(t.width,J.number)},je=function(t,e){return"".concat(t,"/v").concat(e)},Me=function(t){return function(e){return e.url.startsWith("/")?r("".concat(t).concat(e.url),e):r(e.url,e)}},Le=function(t){return function(e){var r=e.data,i=e.headers,o=e.method,a=e.url;return D(void 0,void 0,void 0,(function(){var e,u,s;return I(this,(function(c){switch(c.label){case 0:return[4,t({body:r,headers:i,method:o,url:a})];case 1:if(!(e=c.sent()).ok)throw new Error(qt(e.url,e.statusText));return[4,e.json()];case 2:return u=c.sent(),!(s=n(u,{deep:!0})).data||s.links||s.meta?[2,s]:[2,s.data]}}))}))}},qe=function(t){var e,n=t.clientId,r=t.isForm,i=void 0!==r&&r,o=t.token,a=((e={})[F.userAgent]="".concat(S.editframeJs).concat("0.2.4"),e[F.editframeClientId]=n,e[F.authorization]="".concat(S.bearer).concat(o),e);return i?(a[F.accept]=$.json,a[F.xRequestedWith]=S.xRequestedWithXML):a[F.contentType]=$.json,a},ze=function(t,e){if(t&&e.validate(t))return t;throw new Error(e.invalidDataError)},Pe=((Gt={})[At.audio]=function(t){return ze(t,{invalidDataError:pe,validate:Fe})},Gt[At.image]=function(t){return ze(t,{invalidDataError:pe,validate:Se})},Gt[At.video]=function(t){return ze(t,{invalidDataError:pe,validate:Ce})},Gt),De=function(t){return j.description in t&&be(t.description,J.string)&&j.id in t&&be(t.id,J.string)&&j.name in t&&be(t.name,J.string)&&j.webhook in t&&be(t.webhook,J.string)},Ie=function(t){return Re(t,De)},We=function(){return g().slice(0,6)},Be=function(t){c(t)||f(t,{recursive:!0})},He=function(t){return s.createReadStream(t)},Ne=function(){var t=m("./tmp/".concat(We()));return Be(t),t},Ge=function(t){return c(t)},Ve=function(t){return v(t).ext},Ye=function(t,e){return void 0===t&&(t="/"),void 0===e&&(e={}),"/"===t?t:function(t){return b(t)}(t)(e,{pretty:!0})},Ue=function(t,e,n){var r;return function(t,e){var n=y.stringify(e);return"".concat(t).concat(n?"?".concat(n):"")}(t,((r={})[rt.page]=e,r[rt.perPage]=n,r))},Xe=function(t){return w.unescape(w.escape(t))},Je=function(t){return t&&[1,2,3].includes(Object.keys(t).length)&&W.color in t&&W.duration in t&&W.startTime in t&&be(t[W.color],[J.string,J.undefined])&&be(t[W.duration],J.number)&&be(t[W.startTime],[J.number,J.undefined])},$e=((Vt={})[G.brightness]=function(t){return t&&1===Object.keys(t).length&&W.brightness in t&&be(t[W.brightness],J.number)},Vt[G.contrast]=function(t){return t&&1===Object.keys(t).length&&W.contrast in t&&be(t[W.contrast],J.number)},Vt[G.fadeIn]=Je,Vt[G.fadeOut]=Je,Vt[G.saturation]=function(t){return t&&1===Object.keys(t).length&&W.saturation in t&&be(t[W.saturation],J.number)},Vt),Ke=function(t,e,n,r){var i=n.filterName,o=n.options;void 0===r&&(r=!1);var a=[],u=Object.values(G).includes(i);if(!u){var s=ie(t,ue(e,B.filterName),i,"".concat(Object.values(G).join(", ")));if(r)throw new TypeError(s);a.push(s)}if(u&&i in Rt&&!$e[i](o)){s=ie(t,ue(e,B.options),o,JSON.stringify(Rt[i]));if(r)throw new TypeError(s);a.push(s)}return a},Qe=function(t){return void 0!==t},Ze=function(t,e){var n=e.horizontalAlignment,r=e.verticalAlignment,i=[];return i.push(on(t,q.horizontalAlignment,n)),i.push(an(t,q.verticalAlignment,r)),i.filter(Qe)},tn=function(t,e){var n=[];return n.push(_e(t,q.volume,e.volume,J.number)),n.filter(Qe)},en=function(t,e){var n=e.start,r=[];return r.push(_e(t,q.start,n,J.number)),r.filter(Qe)},nn=function(t,e){var n=e.html,r=n.page,i=n.url,o=n.withTransparentBackground,a=[];return r||i||a.push(se.htmlPageOrURLRequired),a.push(_e(t,ue(q.html,V.page),r,J.string)),a.push(_e(t,ue(q.html,V.withTransparentBackground),o,J.boolean)),a.push(_e(t,ue(q.html,V.url),i,J.string)),a.filter(Qe)},rn=function(t,e){var n=e.filter,r=[];return n&&Ke(t,q.filter,n).forEach((function(t){return r.push(t)})),r.filter(Qe)},on=function(t,e,n){var r=Object.values(H);if(n&&!r.includes(n))return ie(t,e,n,r.join(", "))},an=function(t,e,n){var r=Object.values(N);if(n&&!r.includes(n))return ie(t,e,n,r.join(", "))},un=function(t,e){if(e)return typeof e===J.string?on(t,q.x,e):_e(t,q.x,e,J.number)},sn=function(t,e){if(e)return typeof e===J.string?an(t,q.y,e):_e(t,q.y,e,J.number)},cn=function(t,e){var n=Object.values(K);if(e&&!n.includes(e))return ie(t,q.textAlign,e,n.join(", "))},dn=function(t,e){var n=e.data,r=[];return r.push(_e(t,q.data,n,J.object)),r.filter(Qe)},ln=function(t,e){var n=e.x,r=e.y,i=[];return i.push(un(t,n)),i.push(sn(t,r)),i.filter(Qe)},fn=function(t,e){var n=e.subtitles,r=n.backgroundColor,i=n.color,o=n.fontSize,a=[];return a.push(_e(t,ue(q.subtitles,Y.backgroundColor),r,J.string)),a.push(_e(t,ue(q.subtitles,Y.color),i,J.string)),a.push(_e(t,ue(q.subtitles,Y.fontSize),o,J.number)),a.filter(Qe)},pn=function(t,e){var n=e.color,r=e.fontFamily,i=e.fontSize,o=e.maxFontSize,a=e.maxHeight,u=e.maxWidth,s=e.text,c=e.textAlign,d=[];return d.push(_e(t,q.color,n,J.string)),d.push(_e(t,q.fontFamily,r,J.string)),d.push(_e(t,q.fontSize,i,J.number)),d.push(_e(t,q.maxFontSize,o,J.number)),d.push(_e(t,q.maxHeight,a,J.number)),d.push(_e(t,q.maxWidth,u,J.number)),d.push(_e(t,q.text,s,J.string)),d.push(cn(t,c)),d.filter(Qe)},hn=function(t,e){var n=e.trim,r=[];return r.push(_e(t,ue(q.trim,q.start),null==n?void 0:n.start,J.number)),r.push(_e(t,ue(q.trim,q.end),null==n?void 0:n.end,J.number)),r.filter(Qe)},mn=function(t,e){var n=e.backgroundColor,r=e.format,i=e.x,o=e.y,a=[];return a.push(_e(t,q.backgroundColor,n,J.string)),a.push(function(t,e,n){var r=Object.values(U);if(n&&!r.includes(n))return ie(t,e,n,r.join(", "))}(t,q.format,r)),a.push(un(t,i)),a.push(sn(t,o)),a.filter(Qe)},vn=function(t,e){var n=e.waveform,r=n.backgroundColor,i=n.color,o=n.style,a=[];a.push(_e(t,X.backgroundColor,r,J.string)),a.push(_e(t,X.color,i,J.string)),a.push(_e(t,X.style,o,J.string));var u=Object.values(Q);return o&&!u.includes(o)&&a.push(ie(t,X.style,o,u.join(", "))),a.filter(Qe)},gn=function(t,e){return D(void 0,void 0,void 0,(function(){var n,r;return I(this,(function(o){switch(o.label){case 0:if("string"!=typeof t){if(n=t.path,!Ge(n))throw new Error(ne(n));return[2,{filepath:n,readStream:t}]}return function(t){try{return ye(t),!0}catch(t){return!1}}(t)?[4,(a=t,u=e,D(void 0,void 0,void 0,(function(){var t,e,n;return I(this,(function(r){switch(r.label){case 0:return t=m("".concat(u,"/").concat(We()).concat(Ve(a))),[4,i(a)];case 1:return e=r.sent(),n=d(t),[4,new Promise((function(t,r){e.body.pipe(n),e.body.on("error",r),n.on("finish",t)}))];case 2:return r.sent(),[2,{temporaryFilePath:t}]}}))})))]:[3,2];case 1:return[2,{filepath:r=o.sent().temporaryFilePath,readStream:He(r)}];case 2:if(!Ge(t))throw new Error(ne(t));return[2,{filepath:t,readStream:He(t)}]}var a,u}))}))},bn=function(t){if(we(t,ce),"string"!=typeof t&&!(t instanceof A))throw new Error(ce)},yn=function(t,e,n){var r=t.map((function(t){return t(e,n)})).flat().filter((function(t){return void 0!==t}));if(r.length)throw new TypeError("Validation Errors: ".concat(r.join("\n")))},wn=function(t){return D(void 0,void 0,void 0,(function(){return I(this,(function(e){switch(e.label){case 0:return Ge("./.preview")?k("git pull",{cwd:h.resolve("./.preview"),stdio:[0,1,2]}):(Be("./.preview"),k("git clone https://github.com/editframe/editframe-preview .",{cwd:h.resolve("./.preview"),stdio:[0,1,2]})),l(Lt,t),[4,R("port","9876")];case 1:return e.sent().length||k("cd ".concat("./.preview","; yarn; yarn dev"),{cwd:h.resolve("./.preview"),stdio:[0,1,2]}),[2]}}))}))},_n=function(){function t(t){this._options=P({},t),this._fetch=t.fetch}return t.prototype.get=function(t){var e=t.url;return D(this,void 0,void 0,(function(){return I(this,(function(t){switch(t.label){case 0:return[4,this._fetch({headers:qe(this._options),url:e})];case 1:return[2,t.sent()]}}))}))},t.prototype.post=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return D(this,void 0,void 0,(function(){return I(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:qe(P(P({},this._options),{isForm:r})),method:C.post,url:i})];case 1:return[2,t.sent()]}}))}))},t.prototype.put=function(t){var e=t.data,n=t.isForm,r=void 0!==n&&n,i=t.url;return D(this,void 0,void 0,(function(){return I(this,(function(t){switch(t.label){case 0:return[4,this._fetch({data:e,headers:qe(P(P({},this._options),{isForm:r})),method:C.put,url:i})];case 1:return[2,t.sent()]}}))}))},t}(),xn=function(){function t(t){this._api=t}return t.prototype.all=function(t,e){return D(this,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._api.get({url:Ue(pt.all,t,e)})];case 1:return n=i.sent(),[2,ze(n,{invalidDataError:Pt,validate:Ie}).data];case 2:return r=i.sent(),console.error(zt(r.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype.get=function(t){return D(this,void 0,void 0,(function(){var e,n;return I(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Ye(pt.get,{id:t})})];case 1:return e=r.sent(),[2,ze(e,{invalidDataError:Pt,validate:De})];case 2:return n=r.sent(),console.error(zt(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t}(),An=function(){function t(t){var e=t.composition,n=t.id;this._composition=e,this._id=n}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){return this._composition.getLayerAttribute(this.id,q.start)},enumerable:!1,configurable:!0}),t.prototype[bt.setStart]=function(t){var e=this;return xe((function(){return _e(bt.setStart,q.start,t,J.number,!0)}),(function(){return e._updateAttribute(q.start,t)}))},t.prototype._updateAttribute=function(t,e){return this._composition.updateLayerAttribute(this._id,t,e),this},t}(),kn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),Object.defineProperty(e.prototype,"trim",{get:function(){return this._composition.getLayerAttribute(this.id,q.trim)},enumerable:!1,configurable:!0}),e.prototype[wt.setTrim]=function(t){var e=this,n=t.end,r=t.start;xe((function(){we(r,ae(q.start)),_e(wt.setTrim,q.start,r,J.number,!0),_e(wt.setTrim,q.end,n,J.number,!0)}),(function(){return e._updateAttribute(q.start,r<0?0:r),n&&e._updateAttribute(q.end,n),e}))},e}(An),Rn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[it.setVolume]=function(t){var e=this;return xe((function(){we(t,ae(q.volume)),_e(it.setVolume,q.volume,t,J.number,!0)}),(function(){var n=t;return t>1?n=1:t<0&&(n=0),e._updateAttribute(q.volume,n)}))},e.prototype[it.setMuted]=function(){return this._updateAttribute(q.volume,0)},e}(kn),En=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[vt.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;return xe((function(){return Ke(vt.setFilter,q.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(q.filter,{filterName:n,options:r})}))},e}(An),Tn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[kt.setIsRelative]=function(t){var e=this;void 0===t&&(t=!1),xe((function(){return _e(kt.setIsRelative,q.isRelative,t,J.boolean,!0)}),(function(){return e._updateAttribute(q.isRelative,t)}))},e.prototype[kt.setX]=function(t){var e=this;xe((function(){return un(kt.setX,t)}),(function(){return e._updateAttribute(q.x,t)}))},e.prototype[kt.setY]=function(t){var e=this;xe((function(){return sn(kt.setY,t)}),(function(){return e._updateAttribute(q.y,t)}))},e}(kn),On=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[Et.setDimensions]=function(t){var e=this,n=t.height,r=t.width;xe((function(){we(n,ae(q.height)),we(r,ae(q.width))}),(function(){return e._updateAttribute(q.height,n),e._updateAttribute(q.width,r)}))},e.prototype[Et.setFormat]=function(t){var e=this;xe((function(){return function(t){if(!Object.values(U).includes(t))throw new TypeError(de(t))}(t)}),(function(){return e._updateAttribute(q.format,t)}))},e.prototype[Et.setHeight]=function(t){var e=this;xe((function(){return _e(Et.setHeight,q.height,t,J.number,!0)}),(function(){return e._updateAttribute(q.height,t)}))},e.prototype[Et.setWidth]=function(t){var e=this;xe((function(){return _e(Et.setWidth,q.width,t,J.number,!0)}),(function(){return e._updateAttribute(q.width,t)}))},e}(kn),Fn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[Ct.setBackgroundColor]=function(t){var e=this;xe((function(){return _e(Ct.setBackgroundColor,q.backgroundColor,t,J.string,!0)}),(function(){return e._updateAttribute(q.backgroundColor,t)}))},e.prototype[Ct.setFilter]=function(t){var e=this,n=t.filterName,r=t.options;xe((function(){return Ke(Ct.setFilter,q.filter,{filterName:n,options:r},!0)}),(function(){return e._updateAttribute(q.filter,{filterName:n,options:r})}))},e}(E(kn,Tn,On)),Sn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[gt.setHTMLOptions]=function(t){var e=this;xe((function(){var e;return nn(gt.setHTMLOptions,((e={})[q.html]=t,e))}),(function(){return e._updateAttribute(q.html,t)}))},e}(Fn),Cn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[yt.setAnimationData]=function(t){try{return we(t,ae(q.data)),_e(yt.setAnimationData,q.data,t,J.object),this._updateAttribute(q.data,t)}catch(t){var e=t.stack;ve(e)}},e}(Fn),jn=function(t){function e(e){var n=e.composition,r=e.id,i=e.layers,o=t.call(this,{composition:n,id:r})||this;return o.layers=i,o}return O(e,t),e.prototype[Tt.setStart]=function(t){var e=this;return void 0===t&&(t=0),xe((function(){return _e(Tt.setStart,q.start,t,J.number,!0)}),(function(){return e.layers.forEach((function(n){n.setStart(n.start+(t-e.start))})),e._updateAttribute(q.start,t)}))},e}(An),Mn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[Ot.setSubtitlesOptions]=function(t){var e=this;xe((function(){var e;return fn(Ot.setSubtitlesOptions,((e={})[q.subtitles]=t,e))}),(function(){return e._updateAttribute(q.subtitles,t)}))},e}(Tn),Ln=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e.prototype[Ft.setColor]=function(t){var e=this;xe((function(){return _e(Ft.setColor,q.color,t,J.string,!0)}),(function(){return e._updateAttribute(q.color,t)}))},e.prototype[Ft.setFontFamily]=function(t){var e=this;return xe((function(){return _e(Ft.setFontFamily,q.fontFamily,t,J.string,!0)}),(function(){return e._updateAttribute(q.fontFamily,t)}))},e.prototype[Ft.setFontSize]=function(t){var e=this;return xe((function(){return _e(Ft.setFontSize,q.fontSize,t,J.number,!0)}),(function(){return e._updateAttribute(q.fontSize,t)}))},e.prototype[Ft.setFontWeight]=function(t){var e=this;return xe((function(){return function(t,e,n,r,i){if(void 0===i&&(i=!1),n&&!r.includes(typeof n)){var o=ie(t,e,n,oe(r));if(i)throw new TypeError(o);return o}}(Ft.setFontWeight,q.fontWeight,t,[J.number,J.string],!0)}),(function(){return e._updateAttribute(q.fontWeight,t)}))},e.prototype[Ft.setLineHeight]=function(t){var e=this;return xe((function(){return _e(Ft.setLineHeight,q.lineHeight,t,J.number,!0)}),(function(){return e._updateAttribute(q.lineHeight,t)}))},e.prototype[Ft.setMaxFontSize]=function(t){var e=this;xe((function(){return _e(Ft.setMaxFontSize,q.maxFontSize,t,J.number,!0)}),(function(){return e._updateAttribute(q.maxFontSize,t)}))},e.prototype[Ft.setMaxHeight]=function(t){var e=this;xe((function(){return _e(Ft.setMaxHeight,q.maxHeight,t,J.number,!0)}),(function(){return e._updateAttribute(q.maxHeight,t)}))},e.prototype[Ft.setMaxWidth]=function(t){var e=this;xe((function(){return _e(Ft.setMaxWidth,q.maxWidth,t,J.number,!0)}),(function(){return e._updateAttribute(q.maxWidth,t)}))},e.prototype[Ft.setText]=function(t){var e=this;xe((function(){we(t,se.textRequired),_e(Ft.setText,q.text,t,J.string,!0)}),(function(){return e._updateAttribute(q.text,t)}))},e.prototype[Ft.setTextAlignment]=function(t){var e=this;xe((function(){return cn(Ft.setTextAlignment,t)}),(function(){return e._updateAttribute(q.textAlign,t)}))},e}(Fn),qn=function(t){function e(e){var n=e.composition,r=e.id;return t.call(this,{composition:n,id:r})||this}return O(e,t),e}(E(Rn,Fn)),zn=function(){function n(t){var e=this,n=t.api,r=t.formData,i=t.options,o=t.temporaryDirectory;this._layers=[],this._api=n,this._files=[],this._formData=r,this._options=i,this._temporaryDirectory=null!=o?o:Ne(),xe((function(){return function(t){var e=t.backgroundColor,n=t.dimensions,r=t.duration,i=[];we(r,se.durationRequired),we(n,se.dimensionsRequired),i.push(_e(Mt.new,ue(L.dimensions,q.height),n.height,J.number)),i.push(_e(Mt.new,ue(L.dimensions,q.width),n.width,J.number)),i.push(_e(Mt.new,L.backgroundColor,e,J.string));var o=i.filter((function(t){return void 0!==t}));if(o.length)throw new TypeError(o.join("\n"))}(e._options)}))}return Object.defineProperty(n.prototype,"backgroundColor",{get:function(){return this._options.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dimensions",{get:function(){return this._options.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._options.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this._options.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,ot.layers,{get:function(){return this._layers},enumerable:!1,configurable:!0}),n.prototype[ot.layer]=function(t){return this._layers.find((function(e){return e.id&&e.id===t}))},n.prototype.setDuration=function(t){this._options.duration=t},n.prototype[ot.getLayerAttribute]=function(t,e){return this._layers.find((function(e){return e.id===t}))[e]},n.prototype[ot.updateLayerAttribute]=function(t,e,n){var r=P({},this.layer(t));r[e]=n,this.setLayer(t,r)},n.prototype[ot.updateFile]=function(t,e){this._files.find((function(e){return e.id===t})).file=e},n.prototype[ot.addAudio]=function(t,e){return void 0===e&&(e={}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){bn(t),we(e,se.optionsRequired),function(t){yn([en,hn,tn],ot.addAudio,t)}(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=this._addLayer(P({type:z.audio},e)).id,[4,gn(t,this._temporaryDirectory)];case 1:return r=i.sent().readStream,this._files.push({file:r,id:n}),[2,new Rn({composition:this,id:n})]}}))}))}))]}))}))},n.prototype[ot.addFilter]=function(t){var e=this;return xe((function(){we(t,se.optionsRequired),we(t.filter,se.filterRequired),function(t){yn([en,rn],ot.addFilter,t)}(t)}),(function(){var n=e._addLayer(P(P({},t),{type:z.filter})).id;return new En({composition:e,id:n})}))},n.prototype[ot.addHTML]=function(t){return D(this,void 0,void 0,(function(){var e=this;return I(this,(function(n){switch(n.label){case 0:return[4,Ae((function(){we(t,se.optionsRequired),function(t){yn([en,mn,rn,nn],ot.addHTML,t)}(t)}),(function(){return D(e,void 0,void 0,(function(){var e,n,r,i,o,a,u,s;return I(this,(function(c){switch(c.label){case 0:return e=t.height,n=t.html,r=n.page,i=n.withTransparentBackground,o=t.width,a=P({},t),r?(u=a.html,[4,(d=r,D(void 0,void 0,void 0,(function(){var t,e,n,r,i,o,a,u,s,c,l,f;return I(this,(function(p){switch(p.label){case 0:for(t=new x(d.slice()).window.document,e=t.getElementsByTagName("script"),n=t.querySelectorAll("img"),r=0,i=e;r<i.length;r++)i[r].remove();o=0,a=n,p.label=1;case 1:return o<a.length?(u=a[o],[".","/"].includes(u.src[0])?(c=(s=u).setAttribute,l=["src"],f="data:image/png;base64,".concat,[4,_(u.src)]):[3,3]):[3,4];case 2:c.apply(s,l.concat([f.apply("data:image/png;base64,",[p.sent()])])),p.label=3;case 3:return o++,[3,1];case 4:return[2,Xe(t.documentElement.outerHTML)]}}))})))]):[3,2];case 1:u.page=c.sent(),c.label=2;case 2:return e||(a.height=this._options.dimensions.height),o||(a.width=this._options.dimensions.width),void 0===i&&(a.html.withTransparentBackground=!1),s=this._addLayer(P(P({},a),{type:z.html})).id,[2,new Sn({composition:this,id:s})]}var d}))}))}))];case 1:return[2,n.sent()]}}))}))},n.prototype[ot.addImage]=function(t,e){return void 0===e&&(e={}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){bn(t),we(e,se.optionsRequired),function(t){yn([en,mn,rn],ot.addImage,t)}(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=this._addLayer(P({type:z.image},e)).id,[4,gn(t,this._temporaryDirectory)];case 1:return r=i.sent().readStream,this._files.push({file:r,id:n}),[2,new qn({composition:this,id:n})]}}))}))}))]}))}))},n.prototype[ot.addLottie]=function(t){var e=this;return xe((function(){we(t,se.optionsRequired),we(t.data,se.dataRequired),function(t){yn([en,mn,dn],ot.addLottie,t)}(t)}),(function(){var n=e._addLayer(P({type:z.lottie},t)).id;return new Cn({composition:e,id:n})}))},n.prototype[ot.addSequence]=function(n,r){return void 0===r&&(r={start:0}),D(this,void 0,void 0,(function(){var i=this;return I(this,(function(o){switch(o.label){case 0:return[4,Ae((function(){}),(function(){return D(i,void 0,void 0,(function(){var i,o,a,u=this;return I(this,(function(s){switch(s.label){case 0:return[4,Promise.all(n.map((function(n){return D(u,void 0,void 0,(function(){var r,i,o,a,u,s,c;return I(this,(function(d){switch(d.label){case 0:return(r=this._file(n.id))?[4,gn(r.file,this._temporaryDirectory)]:[3,5];case 1:return a=d.sent(),u=a.filepath,s=a.readStream,c=Ve(u),o=u,function(t){return e.includes(t.replace(/\./g,""))}(c)?[4,this._getMetadata(s,At.video)]:[3,3];case 2:return i=d.sent(),[3,5];case 3:return function(e){return t.includes(e.replace(/\./g,""))}(c)?[4,this._getMetadata(s,At.audio)]:[3,5];case 4:i=d.sent(),d.label=5;case 5:return[2,{duration:i&&_t.duration in i?i.duration:void 0,filepath:o,layer:this.layer(n.id)}]}}))}))})))];case 1:return i=s.sent(),o=r.start||0,i.forEach((function(t){var e=t.duration,n=t.filepath,r=t.layer;if(u.updateLayerAttribute(r.id,q.start,o),n&&u.updateFile(r.id,He(n)),q.trim in r){var i=r.trim,a=i.end,s=i.start,c=void 0===s?0:s;if(a)o+=a-c;else{if(!e)throw new Error(se.trimEndRequired(r.type));o+=e-c}}else{if(!e)throw new Error(se.trimEndRequired(r.type));o=e}})),this.setDuration(o),a=this._addLayer(P({type:z.sequence},r)).id,[2,new jn({composition:this,id:a,layers:n})]}}))}))}))];case 1:return[2,o.sent()]}}))}))},n.prototype[ot.addSubtitles]=function(t,e){return void 0===e&&(e={subtitles:{}}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){bn(t),function(t){yn([en,ln,fn],ot.addSubtitles,t)}(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=this._addLayer(P({type:z.subtitles},e)).id,[4,gn(t,this._temporaryDirectory)];case 1:return r=i.sent().readStream,this._files.push({file:r,id:n}),[2,new Mn({composition:this,id:n})]}}))}))}))]}))}))},n.prototype[ot.addText]=function(t){var e=this;return xe((function(){we(t,se.optionsRequired),we(t.text,se.textRequired),function(t){yn([en,mn,Ze,pn],ot.addText,t)}(t)}),(function(){var n=e._addLayer(P({type:z.text},t)).id;return new Ln({composition:e,id:n})}))},n.prototype[ot.addVideo]=function(t,e){return void 0===e&&(e={}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){bn(t),we(e,se.optionsRequired),function(t){yn([en,hn,tn,mn],ot.addVideo,t)}(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=this._addLayer(P({type:z.video},e)).id,[4,gn(t,this._temporaryDirectory)];case 1:return r=i.sent().readStream,this._files.push({file:r,id:n}),[2,new qn({composition:this,id:n})]}}))}))}))]}))}))},n.prototype[ot.addWaveform]=function(t,e){return void 0===t&&(t={}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){we(t,se.optionsRequired),function(t){yn([en,mn,vn],ot.addWaveform,t)}(t),e&&bn(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=this._addLayer(P({type:z.waveform},t)).id,e?[4,gn(e,this._temporaryDirectory)]:[3,2];case 1:r=i.sent().readStream,this._files.push({file:r,id:n}),i.label=2;case 2:return[2,new Fn({composition:this,id:n})]}}))}))}))]}))}))},n.prototype[ot.preview]=function(){return D(this,void 0,void 0,(function(){return I(this,(function(t){switch(t.label){case 0:return[4,wn(JSON.stringify(P(P({},this._options),{files:this._files,layers:this._layers})))];case 1:return t.sent(),[2]}}))}))},n.prototype[ot.encode]=function(){return D(this,void 0,void 0,(function(){var t,e;return I(this,(function(n){switch(n.label){case 0:this._generateConfig(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._api.post({data:this._formData,isForm:!0,url:mt.create})];case 2:return t=n.sent(),r=this._temporaryDirectory,Ge(r)&&p(r,{recursive:!0}),[2,ze(t,{invalidDataError:se.malformedEncodingResponse,validate:Ee})];case 3:return e=n.sent(),console.error(se.errorEncoding(e.message)),[2,void 0];case 4:return[2]}var r}))}))},n.prototype._generateConfig=function(){var t=this;this._files.forEach((function(e){var n=e.file,r=e.id;return t._formData.append(function(t,e){return"".concat(me(t)).concat(e)}(n,r),n)})),this._formData.append("config",JSON.stringify(P(P({},this._options),{layers:this._layers.filter((function(t){return t.type!==z.sequence}))})))},n.prototype._addLayer=function(t){var e=P({id:We()},t);return this._layers.push(e),e},n.prototype[ot.setLayer]=function(t,e){var n=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],this.layers,!0),r=n.findIndex((function(e){return e.id===t}));n[r]=e,this._layers=n},n.prototype[ot.getMetadata]=function(t,e){return D(this,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return n=he([[me(t),t],[xt.type,e]]),[4,this._api.post({data:n,isForm:!0,url:ht})];case 1:return r=i.sent(),[2,Pe[e](r)]}}))}))},n.prototype._file=function(t){return this._files.find((function(e){return e.id&&e.id===t}))},n}(),Pn=function(){function t(t){this._api=t}return t.prototype[Mt.all]=function(t,e){return D(this,void 0,void 0,(function(){var n,r;return I(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._api.get({url:Ue(mt.all,t,e)})];case 1:return n=i.sent(),[2,ze(n,{invalidDataError:pe,validate:Oe}).data];case 2:return r=i.sent(),console.error(le(r.message)),[3,3];case 3:return[2,[]]}}))}))},t.prototype[Mt.get]=function(t){return D(this,void 0,void 0,(function(){var e,n;return I(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._api.get({url:Ye(mt.get,{id:t})})];case 1:return e=r.sent(),[2,ze(e,{invalidDataError:pe,validate:Te})];case 2:return n=r.sent(),console.error(fe(n.message)),[3,3];case 3:return[2,void 0]}}))}))},t.prototype[Mt.new]=function(t,e){return void 0===t&&(t={backgroundColor:M.black}),D(this,void 0,void 0,(function(){var n=this;return I(this,(function(r){return[2,Ae((function(){!function(t){var e=t.backgroundColor,n=t.dimensions,r=t.duration,i=t.metadata;_e(Mt.new,L.backgroundColor,e,J.string,!0),_e(Mt.new,ue(L.dimensions,q.height),n.height,J.number,!0),_e(Mt.new,ue(L.dimensions,q.width),n.width,J.number,!0),_e(Mt.new,L.duration,r,J.number,!0),_e(Mt.new,L.metadata,i,J.object,!0)}(t),e&&bn(e)}),(function(){return D(n,void 0,void 0,(function(){var n,r,i,o,a,s,c,d,l,f,p,h;return I(this,(function(m){switch(m.label){case 0:return e?(r=Ne(),[4,gn(e,r)]):[3,4];case 1:return i=m.sent(),o=i.filepath,a=i.readStream,[4,this._getMetadata(a)];case 2:return s=m.sent(),p=s.duration,c=s.height,d=s.width,[4,(n=new zn({api:this._api,formData:new u,options:P(P({},t),{dimensions:{height:c,width:d},duration:p}),temporaryDirectory:r})).addVideo(He(o))];case 3:return m.sent(),[3,5];case 4:l=t.backgroundColor,f=t.dimensions,p=t.duration,h=t.metadata,n=new zn({api:this._api,formData:new u,options:{backgroundColor:l,dimensions:f,duration:p,metadata:h}}),m.label=5;case 5:return[2,n]}}))}))}))]}))}))},t.prototype[Mt.getMetadata]=function(t){return D(this,void 0,void 0,(function(){var e,n;return I(this,(function(r){switch(r.label){case 0:return e=he([[me(t),t],[xt.type,At.video]]),[4,this._api.post({data:e,isForm:!0,url:ht})];case 1:return n=r.sent(),[2,ze(n,{invalidDataError:pe,validate:Ce})]}}))}))},t}(),Dn=function(){function t(t){var e,n=t.clientId,r=t.host,i=void 0===r?"https://api.editframe.com":r,o=t.token,a=t.version,u=void 0===a?2:a;if(!n||!o)throw new Error(ee.clientIdAndTokenRequired);this._api=new _n({clientId:n,fetch:(e=je(i,u),Le(Me(e))),host:i,token:o,version:u}),this._clientId=n,this._host=i,this._token=o,this._version=u,this.applications=new xn(this._api),this.videos=new Pn(this._api)}return Object.defineProperty(t.prototype,"clientId",{get:function(){return this._clientId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t}(),In={_1080p:{height:1080,width:1920},_1080pVertical:{height:1920,width:1080},_1080x1080:{height:1080,width:1080},_720p:{height:720,width:1080},_720pVertical:{height:1080,width:720},_720x720:{height:720,width:720}};export{In as CommonResolutions,Dn as Editframe};
//# sourceMappingURL=index.es.js.map
